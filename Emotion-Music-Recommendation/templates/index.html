<!DOCTYPE html>
<html>

<head>
    <title>Emotion Music Recommendation</title>
    <link href="style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Bigelow+Rules&display=swap" rel="stylesheet">
    <style>
      /* Inline CSS for transparent background of the table */
      .overlay {
        --border-style: 3px solid red;
        --border-space: 20px;

        position: absolute;
        width: 590px;
        height: 480px;
    }

    .overlay-helper {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .overlay-element {
        padding: 20px;
        width: 150px;
        height: 100px;
        position: absolute;
    }

    .overlay-text {
        font-size: 1.75em;
        color: white;
        font-family: monospace;
    }

    .overlay .top-left {
        border-left: var(--border-style);
        border-top: var(--border-style);
        top: var(--border-space);
        left: var(--border-space);
        text-align: left;
    }

    .overlay .top-right {
        border-right: var(--border-style);
        border-top: var(--border-style);
        top: var(--border-space);
        right: var(--border-space);
        text-align: right;
    }

    .overlay .bottom-left {
        border-left: var(--border-style);
        border-bottom: var(--border-style);
        bottom: var(--border-space);
        left: var(--border-space);
        text-align: left;
    }

    .overlay .bottom-right {
        border-right: var(--border-style);
        border-bottom: var(--border-style);
        bottom: var(--border-space);
        right: var(--border-space);
        text-align: right;
    }

    #overlay-bottom-left-text {
        position: absolute;
        bottom: var(--border-space);
        left: var(--border-space);
    }

    #overlay-bottom-right-text {
        position: absolute;
        bottom: var(--border-space);
        right: var(--border-space);
    }
    button {
  border: none;
  outline: none;
  padding: 10px 20px;
  border-radius: 50px;
  color: #333;
  background: #a7ee86;
  margin-bottom: 50px;
  box-shadow: 0 3px 20px 0 #0000003b;
}
button:hover{
  cursor: pointer;
}
      #ResultArea {
          padding: 15px;
          width: 49%;
          float: left;
          height: 100%;
          margin: auto;
          text-align: center;
          margin-bottom: 15px;
          background-color: rgba(255, 255, 255, 0); /* Transparent background */
          border-radius: 10px;
          overflow: auto; /* Enable scrolling if content exceeds div height */
      }
  </style>
</head>

<body style="margin: 0;
padding: 0;
background-image: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/221808/sky.jpg');
background-size: cover;
background-position: center;
background-attachment: fixed;">

    <div id="body">

        <div style="color: #ff3300;font-family: 'Dancing Script', cursive;
        font-size: 80px;
        margin-bottom: 30px;">
            <h1 align="center">Emotion Music Recommender</h1>
        </div>

        <div class="container" style="width: 50%; color: #ff3300;font-family: 'Dancing Script', cursive;
        margin-bottom: 30px; float: left; height: 100%; margin: auto; padding-bottom: 25px; text-align: center;">
            <h2 align="center">Emotion Detector</h2>
            <div style="margin: 10px; text-align: center; width: 49%;">
              <div id="content">
                <div class="overlay">
                  <div class="overlay-helper">
                    <div class="overlay-element top-left">
                      <span id="overlay-top-left-text" class="overlay-text">
                        ðŸ”´ REC
                      </span>
                    </div>
                    <div class="overlay-element top-right">
                      <span id="overlay-top-right-text" class="overlay-text">
                        00:00
                      </span>
                    </div>
                    <div class="overlay-element bottom-left">
                      <span id="overlay-bottom-left-text" class="overlay-text">
                        25 FPS
                      </span>
                    </div>
                    <div class="overlay-element bottom-right">
                      <span id="overlay-bottom-right-text" class="overlay-text">
                        1280x720
                      </span>
                    </div>
                  </div>
                </div>
               
               <img class="outer-shadow" id="bg" class="center img-fluid" src="{{ url_for('video_feed') }}" />
            </div>
          </div>
            <button id="refreshButton">Refresh Table</button>
        </div>

        <div style="width: 50%; float: left; height: 100%;font-family:'Dancing Script', cursive;
        margin-bottom: 30px;color: #ff3300; margin: auto; text-align: center;">
            <h2 align="center">Song Recommendations</h2>
        </div>

        <div id="ResultArea" ></div>

    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript">

// Constantly Update Table
    /*setInterval(function() {
        $.getJSON('/t', function(data) {
            CreateHtmlTable(data);
            console.log(data,"DATA");
          });
        return false;
    }, 100);*/
    $("#refreshButton").click(function() {
    refreshTable();
  });

  // Initial call to update the table when the page loads
  $(document).ready(function() {
    refreshTable();
  });

  function refreshTable() {
    $.getJSON('/t', function(data) {
      CreateHtmlTable(data);
      console.log(data, "DATA");
    });
  }

    function CreateHtmlTable(data) {
      //Clear result div
      $("#ResultArea").css("background-color", "transparent").html("");
      //Crate table html tag
      var table = $("<table class='table table-striped table-light table-bordered table-hover table-sm table-responsive transparent-table' id='DynamicTable'></table>").appendTo("#ResultArea");
      //Create table header row
      
      var rowHeader = 
      $("<tr></tr>").css("background-color", "transparent").appendTo(table);
      $("<td></td>").text("Name").css("background-color", "transparent").appendTo(rowHeader);
      $("<td></td").text("Album").css("background-color", "transparent").appendTo(rowHeader);
      $("<td></td>").text("Artist").css("background-color", "transparent").appendTo(rowHeader)
      //Get JSON data by calling action method in controller
      $.each(data, function (i, value) {

          //Create new row for each record
          var row = 
          $("<tr></tr>").css("background-color", "transparent").appendTo(table);
          var songLink = $("<a>")
    .attr("href", "https://open.spotify.com/search/" + encodeURIComponent(value.Name))
    .attr("target", "_blank")
    .text(value.Name)
    .click(function(event) {
        event.preventDefault();
        
        window.open($(this).attr("href"), "_blank");
    });
          $("<td></td>").append(songLink).css("background-color", "transparent").appendTo(row);
          
          $("<td></td>").text(value.Album).css("background-color", "transparent").appendTo(row);
          var artistLink = $("<a>").css("background-color", "transparent").attr("href", "https://open.spotify.com/search/" + encodeURIComponent(value.Artist)).attr("target", "_blank").text(value.Artist);
          $("<td></td>").append(artistLink).css("background-color", "transparent").appendTo(row);
      });
    }

  </script>
</body>
</html>